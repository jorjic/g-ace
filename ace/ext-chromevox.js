define("ace/ext/chromevox",["require","exports","module","ace/editor","ace/config"],function(a){function b(){return"undefined"!=typeof cvox&&cvox&&cvox.Api}function c(a){if(b())pb(a);else{if(qb++,qb>=rb)return;window.setTimeout(c,500,a)}}var d={};d.SpeechProperty,d.Cursor,d.Token,d.Annotation;var e={rate:.8,pitch:.4,volume:.9},f={rate:1,pitch:.5,volume:.9},g={rate:.8,pitch:.8,volume:.9},h={rate:.8,pitch:.3,volume:.9},i={rate:.8,pitch:.7,volume:.9},j={rate:.8,pitch:.8,volume:.9},k={punctuationEcho:"none",relativePitch:-.6},l="ALERT_NONMODAL",m="ALERT_MODAL",n="INVALID_KEYPRESS",o="insertMode",p="start",q=[{substr:";",newSubstr:" semicolon "},{substr:":",newSubstr:" colon "}],r={SPEAK_ANNOT:"annots",SPEAK_ALL_ANNOTS:"all_annots",TOGGLE_LOCATION:"toggle_location",SPEAK_MODE:"mode",SPEAK_ROW_COL:"row_col",TOGGLE_DISPLACEMENT:"toggle_displacement",FOCUS_TEXT:"focus_text"},s="CONTROL + SHIFT ";d.editor=null;var t=null,u={},v=!1,w=!1,x=!1,y=null,z={},A={},B=function(a){return s+String.fromCharCode(a)},C=function(){var a=d.editor.keyBinding.getKeyboardHandler();return"ace/keyboard/vim"===a.$id},D=function(a){return d.editor.getSession().getTokenAt(a.row,a.column+1)},E=function(a){return d.editor.getSession().getLine(a.row)},F=function(a){u[a.row]&&cvox.Api.playEarcon(l),v?(cvox.Api.stop(),R(a),O(D(a)),N(a.row,1)):N(a.row,0)},G=function(a){var b=E(a),c=b.substr(a.column-1);0===a.column&&(c=" "+b);var d=/^\W(\w+)/,e=d.exec(c);return null!==e},H={constant:{prop:e},entity:{prop:g},keyword:{prop:h},storage:{prop:i},variable:{prop:j},meta:{prop:f,replace:[{substr:"</",newSubstr:" closing tag "},{substr:"/>",newSubstr:" close tag "},{substr:"<",newSubstr:" tag start "},{substr:">",newSubstr:" tag end "}]}},I={prop:I},J=function(a,b){for(var c=a,d=0;d<b.length;d++){var e=b[d],f=new RegExp(e.substr,"g");c=c.replace(f,e.newSubstr)}return c},K=function(a,b,c){var d={};d.value="",d.type=a[b].type;for(var e=b;c>e;e++)d.value+=a[e].value;return d},L=function(a){if(a.length<=1)return a;for(var b=[],c=0,d=1;d<a.length;d++){var e=a[c],f=a[d];P(e)!==P(f)&&(b.push(K(a,c,d)),c=d)}return b.push(K(a,c,a.length)),b},M=function(a){var b=d.editor.getSession().getLine(a),c=/^\s*$/;return null!==c.exec(b)},N=function(a,b){var c=d.editor.getSession().getTokens(a);if(0===c.length||M(a))return void cvox.Api.playEarcon("EDITABLE_TEXT");c=L(c);var e=c[0];c=c.filter(function(a){return a!==e}),Q(e,b),c.forEach(O)},O=function(a){Q(a,1)},P=function(a){if(a&&a.type){var b=a.type.split(".");if(0!==b.length){var c=b[0],d=H[c];return d?d:I}}},Q=function(a,b){var c=P(a),d=J(a.value,q);c.replace&&(d=J(d,c.replace)),cvox.Api.speak(d,b,c.prop)},R=function(a){var b=E(a);cvox.Api.speak(b[a.column],1)},S=function(a,b){var c=E(b),d=c.substring(a.column,b.column);d=d.replace(/ /g," space "),cvox.Api.speak(d)},T=function(a,b){if(1!==Math.abs(a.column-b.column)){var c=E(b).length;if(0===b.column||b.column===c)return void N(b.row,0);if(G(b))return cvox.Api.stop(),void O(D(b))}R(b)},U=function(a,b){d.editor.selection.isEmpty()?w?S(a,b):T(a,b):(S(a,b),cvox.Api.speak("selected",1))},V=function(){if(x)return void(x=!1);var a=d.editor.selection.getCursor();a.row!==t.row?F(a):U(t,a),t=a},W=function(){d.editor.selection.isEmpty()&&cvox.Api.speak("unselected")},X=function(a){var b=a.data;switch(b.action){case"removeText":cvox.Api.speak(b.text,0,k),x=!0;break;case"insertText":cvox.Api.speak(b.text,0),x=!0}},Y=function(a){var b=a.row,c=a.column;return!u[b]||!u[b][c]},Z=function(a){u={};for(var b=0;b<a.length;b++){var c=a[b],d=c.row,e=c.column;u[d]||(u[d]={}),u[d][e]=c}},$=function(){var a=d.editor.getSession().getAnnotations(),b=a.filter(Y);b.length>0&&cvox.Api.playEarcon(l),Z(a)},_=function(a){var b=a.type+" "+a.text+" on "+bb(a.row,a.column);b=b.replace(";","semicolon"),cvox.Api.speak(b,1)},ab=function(a){var b=u[a];for(var c in b)_(b[c])},bb=function(a,b){return"row "+(a+1)+" column "+(b+1)},cb=function(){cvox.Api.speak(bb(t.row,t.column))},db=function(){for(var a in u)ab(a)},eb=function(){if(C())switch(d.editor.keyBinding.$data.state){case o:cvox.Api.speak("Insert mode");break;case p:cvox.Api.speak("Command mode")}},fb=function(){v=!v,cvox.Api.speak(v?"Speak location on row change enabled.":"Speak location on row change disabled.")},gb=function(){w=!w,cvox.Api.speak(w?"Speak displacement on column changes.":"Speak current character or word on column changes.")},hb=function(a){if(a.ctrlKey&&a.shiftKey){var b=z[a.keyCode];b&&b.func()}},ib=function(a,b){if(C()){var c=b.keyBinding.$data.state;if(c!==y){switch(c){case o:cvox.Api.playEarcon(m),cvox.Api.setKeyEcho(!0);break;case p:cvox.Api.playEarcon(m),cvox.Api.setKeyEcho(!1)}y=c}}},jb=function(a){var b=a.detail.customCommand,c=A[b];c&&(c.func(),d.editor.focus())},kb=function(){var a=nb.map(function(a){return{desc:a.desc+B(a.keyCode),cmd:a.cmd}}),b=document.querySelector("body");b.setAttribute("contextMenuActions",JSON.stringify(a)),b.addEventListener("ATCustomEvent",jb,!0)},lb=function(a){a.match?N(t.row,0):cvox.Api.playEarcon(n)},mb=function(){d.editor.focus()},nb=[{keyCode:49,func:function(){ab(t.row)},cmd:r.SPEAK_ANNOT,desc:"Speak annotations on line"},{keyCode:50,func:db,cmd:r.SPEAK_ALL_ANNOTS,desc:"Speak all annotations"},{keyCode:51,func:eb,cmd:r.SPEAK_MODE,desc:"Speak Vim mode"},{keyCode:52,func:fb,cmd:r.TOGGLE_LOCATION,desc:"Toggle speak row location"},{keyCode:53,func:cb,cmd:r.SPEAK_ROW_COL,desc:"Speak row and column"},{keyCode:54,func:gb,cmd:r.TOGGLE_DISPLACEMENT,desc:"Toggle speak displacement"},{keyCode:55,func:mb,cmd:r.FOCUS_TEXT,desc:"Focus text"}],ob=function(){d.editor=editor,editor.getSession().selection.on("changeCursor",V),editor.getSession().selection.on("changeSelection",W),editor.getSession().on("change",X),editor.getSession().on("changeAnnotation",$),editor.on("changeStatus",ib),editor.on("findSearchBox",lb),editor.container.addEventListener("keydown",hb),t=editor.selection.getCursor()},pb=function(a){ob(),nb.forEach(function(a){z[a.keyCode]=a,A[a.cmd]=a}),a.on("focus",ob),C()&&cvox.Api.setKeyEcho(!1),kb()},qb=0,rb=15,sb=a("../editor").Editor;a("../config").defineOptions(sb.prototype,"editor",{enableChromevoxEnhancements:{set:function(a){a&&c(this)},value:!0}})}),function(){window.require(["ace/ext/chromevox"],function(){})}();